{% extends "base.html" %}

{% block title %}Forgot Password - Speed Dating{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8">
        <!-- Logo and Header -->
        <div class="text-center">
            <div class="flex justify-center mb-4">
                <div class="p-4 bg-red-900/50 rounded-full">
                    <svg class="w-8 h-8 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m0 0a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2m0 0V7a2 2 0 012-2m3 0a2 2 0 00-2-2m0 0a2 2 0 00-2 2"></path>
                    </svg>
                </div>
            </div>
            <h1 class="text-4xl font-bold text-gradient mb-2">Forgot Password</h1>
            <h2 class="text-xl text-slate-300">Reset your account password</h2>
            <p class="text-sm text-slate-400 mt-2">
                Enter your email address and we'll send you a link to reset your password.
            </p>
        </div>

        <!-- Forgot Password Form -->
        <div class="card">
            <form id="forgot-password-form" 
                  hx-post="/auth/forgot-password" 
                  hx-target="#result-container"
                  hx-swap="innerHTML"
                  class="space-y-6">
                
                <!-- CSRF Protection -->
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                
                <!-- Email -->
                <div class="form-group">
                    <label for="email" class="form-label required">
                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"></path>
                        </svg>
                        Email Address
                    </label>
                    <input 
                        id="email"
                        name="email" 
                        type="email" 
                        required 
                        class="form-input"
                        placeholder="Enter your registered email address"
                        autocomplete="email"
                    >
                    <p class="form-help">
                        We'll send password reset instructions to this email address.
                    </p>
                </div>

                <!-- Submit Button -->
                <div class="form-group">
                    <button 
                        type="submit" 
                        class="btn btn-primary w-full">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 7.89a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                        Send Reset Instructions
                    </button>
                </div>
            </form>

            <!-- Result Container -->
            <div id="result-container" class="mt-6"></div>

            <!-- Back to Login -->
            <div class="mt-6 text-center">
                <p class="text-sm text-slate-400">
                    Remember your password?
                    <a href="/auth/login" 
                       class="text-red-400 hover:text-red-300 font-medium">
                        Sign in here
                    </a>
                </p>
            </div>
        </div>

        <!-- Security Notice -->
        <div class="bg-blue-900/20 border border-blue-600/30 rounded-lg p-4">
            <div class="flex items-start">
                <svg class="w-5 h-5 text-blue-400 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                    <h3 class="text-sm font-medium text-blue-300 mb-1">Security Notice</h3>
                    <p class="text-xs text-blue-200">
                        • Reset links expire after 1 hour for security<br>
                        • Only works for accounts registered with email/password<br>
                        • OAuth users (Google, Facebook) should use their provider's reset
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('forgot-password-form');
    const resultContainer = document.getElementById('result-container');
    const emailInput = document.getElementById('email');
    
    // Focus on email field
    emailInput.focus();
    
    // Handle form submission response
    document.body.addEventListener('htmx:afterRequest', function(event) {
        if (event.target.id === 'forgot-password-form') {
            const response = event.detail.xhr.response;
            
            try {
                const data = JSON.parse(response);
                
                if (event.detail.successful && data.success) {
                    // Success
                    resultContainer.innerHTML = `
                        <div class="bg-green-900/20 border border-green-600/30 rounded-lg p-4">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-green-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div>
                                    <h3 class="text-sm font-medium text-green-300">${data.message}</h3>
                                    <p class="text-xs text-green-200 mt-1">
                                        Please check your email for reset instructions. The link will expire in 1 hour.
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Disable the form
                    form.style.opacity = '0.6';
                    form.querySelector('button[type="submit"]').disabled = true;
                    
                } else {
                    // Error from API
                    const message = data.message || data.detail || 'An error occurred';
                    resultContainer.innerHTML = `
                        <div class="bg-red-900/20 border border-red-600/30 rounded-lg p-4">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-red-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div>
                                    <h3 class="text-sm font-medium text-red-300">Request Failed</h3>
                                    <p class="text-xs text-red-200 mt-1">${message}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
            } catch (e) {
                // Parse error or other issue
                resultContainer.innerHTML = `
                    <div class="bg-red-900/20 border border-red-600/30 rounded-lg p-4">
                        <div class="flex items-center">
                            <svg class="w-5 h-5 text-red-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <div>
                                <h3 class="text-sm font-medium text-red-300">Request Failed</h3>
                                <p class="text-xs text-red-200 mt-1">An unexpected error occurred. Please try again.</p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
    });
    
    // Handle loading state
    document.body.addEventListener('htmx:beforeRequest', function(event) {
        if (event.target.id === 'forgot-password-form') {
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.innerHTML = `
                <svg class="animate-spin w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Sending Instructions...
            `;
        }
    });
    
    document.body.addEventListener('htmx:afterRequest', function(event) {
        if (event.target.id === 'forgot-password-form') {
            const submitBtn = form.querySelector('button[type="submit"]');
            if (!submitBtn.disabled) {
                submitBtn.innerHTML = `
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 7.89a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                    Send Reset Instructions
                `;
            }
        }
    });
});
</script>
{% endblock %}